<!DOCTYPE html>
<html lang="en" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FluxGen Pro Studio</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        // The new ultra-dark palette
                        background: '#000000',
                        panel: '#0a0a0a', 
                        surface: '#121212',
                        border: '#27272a', // Zinc 800
                        accent: '#8b5cf6', // Violet 500
                        accentAlt: '#06b6d4', // Cyan 500
                    },
                    backgroundImage: {
                        'gradient-accent': 'linear-gradient(to right, #8b5cf6, #06b6d4)',
                        'gradient-dark': 'linear-gradient(to bottom right, #121212, #000000)',
                    }
                }
            }
        }
    </script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap');
        
        body { 
            font-family: 'Inter', sans-serif; 
            background: #000000; 
            color: #f4f4f5; /* Zinc 100 */
        }
        
        .font-mono { font-family: 'JetBrains Mono', monospace; }

        /* Subtler Glass */
        .glass-panel {
            background: rgba(18, 18, 18, 0.6);
            backdrop-filter: blur(16px);
            -webkit-backdrop-filter: blur(16px);
            border: 1px solid rgba(255, 255, 255, 0.08);
        }
        
        /* Sleek Scrollbar */
        .custom-scrollbar::-webkit-scrollbar { width: 5px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: transparent; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #3f3f46; border-radius: 10px; }
        .custom-scrollbar::-webkit-scrollbar-thumb:hover { background: #52525b; }

        /* Modern Range Slider */
        input[type=range] {
            -webkit-appearance: none; background: transparent; height: 24px;
        }
        input[type=range]::-webkit-slider-runnable-track {
            width: 100%; height: 4px; cursor: pointer; background: #27272a; border-radius: 2px;
        }
        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none; height: 16px; width: 16px; border-radius: 50%;
            background: #f4f4f5; cursor: pointer; margin-top: -6px;
            box-shadow: 0 0 10px rgba(139, 92, 246, 0.5); /* Violet glow */
            transition: all 0.2s;
        }
        input[type=range]:hover::-webkit-slider-thumb {
            background: #8b5cf6;
            transform: scale(1.1);
        }

        /* Animations */
        @keyframes loading {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(200%); }
        }
        .shimmer-loading {
            background: linear-gradient(90deg, transparent, rgba(139, 92, 246, 0.1), transparent);
            animation: loading 1.5s infinite;
        }
    </style>
</head>
<body class="h-screen flex overflow-hidden bg-background">

    <aside class="w-72 bg-black/90 backdrop-blur-xl border-r border-border flex flex-col hidden md:flex z-30 relative">
        <div class="absolute top-0 left-0 w-full h-64 bg-accent/10 blur-[100px] -z-10 pointer-events-none"></div>

        <div class="p-6 flex items-center gap-3 mb-4">
            <div class="w-8 h-8 rounded-md bg-gradient-accent flex items-center justify-center shadow-[0_0_15px_rgba(139,92,246,0.3)]">
                <i class="fa-solid fa-cube text-white text-sm"></i>
            </div>
            <h1 class="text-lg font-bold tracking-tight text-white">FluxGen <span class="text-transparent bg-clip-text bg-gradient-accent">Studio</span></h1>
        </div>

        <nav class="flex-1 px-4 space-y-1 overflow-y-auto custom-scrollbar">
            <div class="text-[11px] font-semibold text-zinc-500 uppercase tracking-widest mb-3 px-2">Generative Models</div>
            
            <button onclick="selectModel('flux-dev')" id="nav-flux-dev" class="model-btn active">
                <i class="fa-solid fa-bolt mr-3 w-4 text-center"></i> Flux Dev <span class="ml-auto text-[10px] opacity-60 font-mono">F.2</span>
            </button>
            <button onclick="selectModel('flux-klein')" id="nav-flux-klein" class="model-btn">
                <i class="fa-solid fa-wind mr-3 w-4 text-center"></i> Flux Klein <span class="ml-auto text-[10px] opacity-60 font-mono">9B</span>
            </button>
            <button onclick="selectModel('lucid-origin')" id="nav-lucid-origin" class="model-btn">
                <i class="fa-solid fa-gem mr-3 w-4 text-center text-amber-500"></i> Lucid Origin
            </button>
            <button onclick="selectModel('dreamshaper')" id="nav-dreamshaper" class="model-btn">
                <i class="fa-solid fa-camera-retro mr-3 w-4 text-center"></i> DreamShaper 8
            </button>
            <div class="my-4 border-t border-border/50 mx-2"></div>
             <div class="text-[11px] font-semibold text-zinc-500 uppercase tracking-widest mb-3 px-2">Stable Diffusion</div>
            <button onclick="selectModel('stable-diffusion-xl-lightning')" id="nav-stable-diffusion-xl-lightning" class="model-btn">
                <i class="fa-solid fa-bolt-lightning mr-3 w-4 text-center text-yellow-500"></i> SDXL Lightning
            </button>
            <button onclick="selectModel('stable-diffusion-xl-base')" id="nav-stable-diffusion-xl-base" class="model-btn">
                <i class="fa-solid fa-layer-group mr-3 w-4 text-center"></i> SDXL Base 1.0
            </button>
            
            <div class="text-[11px] font-semibold text-zinc-500 uppercase tracking-widest mb-3 px-2 mt-6">Tools</div>
            <button onclick="selectModel('stable-diffusion-img2img')" id="nav-stable-diffusion-img2img" class="model-btn">
                <i class="fa-solid fa-wand-magic-sparkles mr-3 w-4 text-center text-pink-500"></i> Img2Img (SD 1.5)
            </button>
        </nav>

        <div class="p-4 border-t border-border bg-black/50">
            <div class="flex items-center justify-between text-xs text-zinc-400 font-mono">
                <span id="storage-status"><i class="fa-solid fa-database mr-2"></i>...</span>
                <button onclick="clearHistory()" class="hover:text-red-400 transition px-2 py-1 hover:bg-red-500/10 rounded">Clear DB</button>
            </div>
        </div>
    </aside>

    <main class="flex-1 flex flex-col h-full overflow-hidden relative bg-background">
        
        <div class="md:hidden flex items-center justify-between p-4 bg-black border-b border-border">
            <h1 class="font-bold flex items-center gap-2"><i class="fa-solid fa-cube text-accent"></i> FluxGen Studio</h1>
        </div>

        <div class="flex-1 flex overflow-hidden relative">
             <div class="absolute top-1/3 right-0 w-96 h-96 bg-accentAlt/5 blur-[150px] -z-10 pointer-events-none"></div>

            <div class="flex-1 overflow-y-auto custom-scrollbar p-4 lg:p-8 scroll-smooth">
                
                <div class="max-w-5xl mx-auto space-y-6">
                    
                    <div class="glass-panel rounded-2xl p-1.5 focus-within:ring-1 focus-within:ring-accent/50 transition-all shadow-2xl shadow-black/50 relative overflow-hidden">
                        <div class="absolute inset-0 shimmer-loading opacity-0 pointer-events-none transition-opacity" id="promptShimmer"></div>
                        <div class="bg-[#0a0a0a] rounded-xl p-4 relative">
                             <div class="flex justify-between items-center mb-3">
                                <label class="text-xs font-semibold text-accent uppercase tracking-wider flex items-center gap-2">
                                    <i class="fa-solid fa-terminal"></i> Positive Prompt
                                </label>
                                <span id="activeModelLabel" class="text-[10px] font-mono bg-zinc-900 px-2 py-0.5 rounded-full text-zinc-400 border border-zinc-800 flex items-center gap-1">
                                    <span class="w-1.5 h-1.5 rounded-full bg-green-500 inline-block"></span> Flux Dev
                                </span>
                            </div>
                            <textarea id="promptInput" rows="3" 
                                class="w-full bg-transparent border-none outline-none text-base text-white placeholder-zinc-600 resize-none font-light"
                                placeholder="Describe your imagination... e.g., A futuristic city with bioluminescent plants, cinematic lighting, 8k resolution"></textarea>
                            
                            <div class="flex justify-between items-center mt-3 pt-3 border-t border-zinc-800/50">
                                <div id="imgInputContainer" class="hidden flex items-center gap-2">
                                    <input type="file" id="imageUpload" accept="image/*" class="hidden" onchange="handleImageSelect(this)">
                                    <button onclick="document.getElementById('imageUpload').click()" class="text-xs flex items-center gap-2 bg-zinc-900 hover:bg-zinc-800 px-3 py-1.5 rounded-lg transition text-zinc-300 border border-zinc-800">
                                        <i class="fa-solid fa-image"></i> Upload Source
                                    </button>
                                    <img id="previewUpload" class="hidden h-8 w-8 rounded object-cover border border-zinc-700">
                                </div>
                                <div id="imgInputPlaceholder" class="flex-1"></div> <button onclick="generate()" id="genBtn" class="bg-gradient-accent hover:opacity-90 text-white py-2 px-6 rounded-lg shadow-[0_0_20px_rgba(139,92,246,0.3)] transition-all flex items-center gap-2 font-semibold text-sm group relative overflow-hidden">
                                    <span class="relative z-10">Generate</span> <i class="fa-solid fa-wand-magic-sparkles relative z-10 group-hover:rotate-12 transition-transform"></i>
                                    <div class="absolute inset-0 bg-white/20 translate-y-full group-hover:translate-y-0 transition-transform duration-300"></div>
                                </button>
                            </div>
                        </div>
                    </div>

                    <div class="flex flex-col lg:flex-row gap-6">
                        <div class="w-full lg:w-80 space-y-6">
                             <div class="glass-panel rounded-xl p-5">
                                <label class="text-[11px] font-semibold text-zinc-500 uppercase mb-3 block flex items-center gap-2">
                                    <i class="fa-solid fa-ban"></i> Negative Prompt
                                </label>
                                <textarea id="negativePrompt" rows="2"
                                    class="w-full bg-[#0a0a0a] border border-zinc-800 rounded-lg p-3 text-sm focus:border-accent outline-none text-zinc-300 resize-none placeholder-zinc-700 transition-colors"
                                    placeholder="blurry, low quality, distorted..."></textarea>
                            </div>

                            <div class="glass-panel rounded-xl p-5 space-y-6">
                                <div>
                                    <div class="flex justify-between text-[11px] uppercase font-semibold mb-3 text-zinc-500">
                                        <span>Width</span>
                                        <span id="widthVal" class="text-accent font-mono bg-accent/10 px-1.5 rounded">1024</span>
                                    </div>
                                    <input type="range" id="widthInput" min="256" max="1440" step="64" value="1024" oninput="updateRange('width', this.value)">
                                </div>
                                <div>
                                    <div class="flex justify-between text-[11px] uppercase font-semibold mb-3 text-zinc-500">
                                        <span>Height</span>
                                        <span id="heightVal" class="text-accent font-mono bg-accent/10 px-1.5 rounded">768</span>
                                    </div>
                                    <input type="range" id="heightInput" min="256" max="1440" step="64" value="768" oninput="updateRange('height', this.value)">
                                </div>
                            </div>
                        </div>

                        <div class="flex-1 relative bg-[#050505] rounded-2xl border border-border overflow-hidden min-h-[400px] lg:min-h-[500px] flex items-center justify-center group shadow-2xl shadow-black" id="viewport">
                            
                            <div id="placeholderState" class="text-center p-8">
                                <div class="w-20 h-20 bg-zinc-900/50 rounded-2xl flex items-center justify-center mx-auto mb-4 border border-zinc-800/50">
                                    <i class="fa-solid fa-image text-3xl text-zinc-700"></i>
                                </div>
                                <h3 class="text-zinc-300 font-medium">Canvas Empty</h3>
                                <p class="text-zinc-600 text-sm mt-2 max-w-xs mx-auto">Configure your settings and enter a prompt to begin creating.</p>
                            </div>

                            <div id="loadingState" class="hidden absolute inset-0 z-10 flex flex-col items-center justify-center bg-black/80 backdrop-blur-md">
                                <div class="relative">
                                    <div class="w-16 h-16 border-4 border-zinc-800 rounded-full"></div>
                                    <div class="w-16 h-16 border-4 border-t-accent border-r-accentAlt border-b-transparent border-l-transparent rounded-full animate-spin absolute inset-0"></div>
                                </div>
                                <p class="mt-6 text-transparent bg-clip-text bg-gradient-accent font-medium animate-pulse">Creating masterpiece...</p>
                            </div>

                            <img id="resultImage" class="hidden w-full h-full object-contain transition-transform duration-500 group-hover:scale-[1.02]" crossorigin="anonymous">
                            
                            <div id="resultActions" class="hidden absolute inset-0 bg-black/40 opacity-0 group-hover:opacity-100 transition-opacity flex items-end justify-center p-6 backdrop-blur-[2px]">
                                <div class="flex gap-3 p-2 bg-black/60 backdrop-blur-xl rounded-2xl border border-white/10 translate-y-4 group-hover:translate-y-0 transition-transform">
                                    <button onclick="downloadCurrentImage()" class="hover:bg-white/10 text-zinc-300 hover:text-white px-4 py-2 rounded-xl flex items-center gap-2 transition">
                                        <i class="fa-solid fa-download"></i> <span class="text-sm">Save</span>
                                    </button>
                                    <a id="hdLink" target="_blank" class="bg-white/10 hover:bg-white/20 text-white px-4 py-2 rounded-xl flex items-center gap-2 transition border border-white/5">
                                        <i class="fa-solid fa-expand"></i> <span class="text-sm">Full Size</span>
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="pt-8 border-t border-border">
                        <h3 class="text-sm font-semibold text-zinc-400 mb-6 uppercase tracking-wider flex items-center gap-2">
                            <i class="fa-solid fa-clock-rotate-left"></i> Recent Creations
                        </h3>
                        <div id="historyGrid" class="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-5 gap-4">
                            </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <style>
        .model-btn {
            @apply w-full text-left px-4 py-3 rounded-xl text-xs font-medium text-zinc-400 transition-all border border-transparent flex items-center hover:bg-zinc-900/50 hover:text-zinc-200;
        }
        .model-btn.active {
            @apply bg-[#121212] text-white border-zinc-800/80 shadow-[inset_0_1px_1px_rgba(255,255,255,0.05)];
        }
        .model-btn.active i {
            @apply text-accent;
        }
    </style>

    <script>
        // --- Configuration ---
        const API_BASE = "https://wild-art-dca7.veltrix620.workers.dev";
        let state = {
            model: 'flux-dev', 
            modelName: 'Flux Dev',
            base64Input: null,
            currentResultUrl: null
        };

        const endpoints = {
            'flux-dev': { url: '/flux-dev', name: 'Flux Dev' },
            'flux-klein': { url: '/flux-klein', name: 'Flux Klein 9B' },
            'lucid-origin': { url: '/lucid-origin', name: 'Lucid Origin' },
            'dreamshaper': { url: '/dreamshaper', name: 'DreamShaper 8' },
            'stable-diffusion-img2img': { url: '/stable-diffusion-img2img', name: 'SD 1.5 Img2Img', needsImage: true },
            'stable-diffusion-xl-lightning': { url: '/stable-diffusion-xl-lightning', name: 'SDXL Lightning' },
            'stable-diffusion-xl-base': { url: '/stable-diffusion-xl-base', name: 'SDXL Base 1.0' }
        };

        // --- IndexedDB ---
        let db;
        const DB_NAME = 'FluxProDB_V2'; // Bumped DB name for clean slate with new UI
        const STORE_NAME = 'generations';

        function initDB() {
            const request = indexedDB.open(DB_NAME, 1);
            request.onupgradeneeded = (e) => {
                const db = e.target.result;
                if (!db.objectStoreNames.contains(STORE_NAME)) {
                    db.createObjectStore(STORE_NAME, { keyPath: "id", autoIncrement: true })
                      .createIndex("date", "date", { unique: false });
                }
            };
            request.onsuccess = (e) => {
                db = e.target.result;
                loadHistory();
                updateStorageInfo();
            };
        }

        // --- UI Interactions ---

        function selectModel(id) {
            state.model = id;
            state.modelName = endpoints[id].name;
            
            // Update Sidebar UI classes
            document.querySelectorAll('.model-btn').forEach(b => b.classList.remove('active'));
            document.getElementById(`nav-${id}`).classList.add('active');

            document.getElementById('activeModelLabel').innerHTML = `<span class="w-1.5 h-1.5 rounded-full bg-accent inline-block"></span> ${state.modelName}`;

            const imgContainer = document.getElementById('imgInputContainer');
            const imgPlaceholder = document.getElementById('imgInputPlaceholder');
            
            if (endpoints[id].needsImage) {
                imgContainer.classList.remove('hidden');
                imgPlaceholder.classList.add('hidden');
            } else {
                imgContainer.classList.add('hidden');
                imgPlaceholder.classList.remove('hidden');
                state.base64Input = null;
                document.getElementById('imageUpload').value = "";
                resetUploadPreview();
            }
        }

        function updateRange(type, val) {
            document.getElementById(`${type}Val`).innerText = val;
        }

        function handleImageSelect(input) {
            if (input.files && input.files[0]) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    state.base64Input = e.target.result;
                    const preview = document.getElementById('previewUpload');
                    preview.src = e.target.result;
                    preview.classList.remove('hidden');
                }
                reader.readAsDataURL(input.files[0]);
            }
        }

        function resetUploadPreview() {
            document.getElementById('previewUpload').classList.add('hidden');
        }

        // --- Generation Logic ---

        async function generate() {
            const prompt = document.getElementById('promptInput').value.trim();
            const negPrompt = document.getElementById('negativePrompt').value.trim();
            const width = document.getElementById('widthInput').value;
            const height = document.getElementById('heightInput').value;
            const btn = document.getElementById('genBtn');
            const shimmer = document.getElementById('promptShimmer');

            if (!prompt) { alert("Please write a prompt first!"); return; }
            if (endpoints[state.model].needsImage && !state.base64Input) {
                alert("This model requires a source image."); return;
            }

            // Set Loading UI
            btn.disabled = true;
            btn.classList.add('opacity-80', 'cursor-not-allowed');
            btn.innerHTML = '<i class="fa-solid fa-circle-notch animate-spin"></i> Processing...';
            shimmer.classList.remove('opacity-0'); // Activate shimmer
            
            document.getElementById('placeholderState').classList.add('hidden');
            document.getElementById('loadingState').classList.remove('hidden');
            document.getElementById('resultImage').classList.add('hidden');
            document.getElementById('resultActions').classList.add('hidden');

            try {
                const config = endpoints[state.model];
                let fullUrl = `${API_BASE}${config.url}`;
                
                const params = new URLSearchParams({ prompt: prompt, width: width, height: height });
                if (negPrompt) params.append('negative_prompt', negPrompt);
                
                let fetchOptions = { method: 'GET' };

                if (config.needsImage) {
                    fetchOptions = {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            prompt: prompt,
                            negative_prompt: negPrompt,
                            width: parseInt(width),
                            height: parseInt(height),
                            image: state.base64Input
                        })
                    };
                } else {
                    fullUrl += `?${params.toString()}`;
                }

                const response = await fetch(fullUrl, fetchOptions);
                const data = await response.json();

                if (data.success) {
                    const imageUrl = data.url || data.image;
                    state.currentResultUrl = imageUrl;

                    const imgEl = document.getElementById('resultImage');
                    // Pre-load image before showing
                    const tempImg = new Image();
                    tempImg.onload = () => {
                        imgEl.src = imageUrl;
                        document.getElementById('loadingState').classList.add('hidden');
                        imgEl.classList.remove('hidden');
                        document.getElementById('resultActions').classList.remove('hidden');
                        document.getElementById('hdLink').href = imageUrl;
                        shimmer.classList.add('opacity-0'); // Stop shimmer
                    };
                     tempImg.onerror = () => { throw new Error("Failed to load resulting image URL"); }
                    tempImg.src = imageUrl;

                    saveToHistory({
                        id: Date.now(),
                        image: imageUrl,
                        delete_url: data.delete_url || null,
                        prompt: prompt,
                        model: state.modelName,
                        date: new Date(),
                        width: data.width,
                        height: data.height
                    });

                } else {
                    throw new Error(data.error || "Generation failed");
                }

            } catch (err) {
                console.error(err);
                alert("Error: " + err.message);
                document.getElementById('loadingState').classList.add('hidden');
                document.getElementById('placeholderState').classList.remove('hidden');
                shimmer.classList.add('opacity-0');
            } finally {
                btn.disabled = false;
                btn.classList.remove('opacity-80', 'cursor-not-allowed');
                btn.innerHTML = '<span class="relative z-10">Generate</span> <i class="fa-solid fa-wand-magic-sparkles relative z-10 group-hover:rotate-12 transition-transform"></i><div class="absolute inset-0 bg-white/20 translate-y-full group-hover:translate-y-0 transition-transform duration-300"></div>';
            }
        }

        async function downloadCurrentImage() {
            if (!state.currentResultUrl) return;
            try {
                const response = await fetch(state.currentResultUrl);
                const blob = await response.blob();
                const url = window.URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `flux-gen-${Date.now()}.png`;
                document.body.appendChild(a);
                a.click();
                window.URL.revokeObjectURL(url);
                document.body.removeChild(a);
            } catch (e) {
                window.open(state.currentResultUrl, '_blank');
            }
        }

        // --- History & Storage ---

        function saveToHistory(record) {
            const tx = db.transaction(STORE_NAME, "readwrite");
            tx.objectStore(STORE_NAME).add(record);
            tx.oncomplete = () => { loadHistory(); updateStorageInfo(); };
        }

        function loadHistory() {
            const tx = db.transaction(STORE_NAME, "readonly");
            const store = tx.objectStore(STORE_NAME);
            const index = store.index("date");
            const grid = document.getElementById('historyGrid');
            grid.innerHTML = ''; 

            index.openCursor(null, 'prev').onsuccess = (e) => {
                const cursor = e.target.result;
                if (cursor) {
                    renderCard(cursor.value, grid);
                    cursor.continue();
                }
            };
        }

        function renderCard(data, container) {
            const div = document.createElement('div');
            // Updated card styling for new theme
            div.className = "group relative aspect-square bg-[#0a0a0a] rounded-xl overflow-hidden border border-zinc-800 cursor-pointer shadow-md hover:shadow-accent/20 transition-all hover:border-accent/50";
            div.onclick = () => loadFromHistory(data);

            const imgSrc = data.image;

            div.innerHTML = `
                <img src="${imgSrc}" class="w-full h-full object-cover transition duration-700 group-hover:scale-110 group-hover:opacity-50" loading="lazy">
                 <div class="absolute inset-0 bg-gradient-to-t from-[#000] via-transparent to-transparent opacity-0 group-hover:opacity-100 transition-opacity flex flex-col justify-end p-4">
                    <div class="flex items-center justify-between mb-1">
                        <span class="text-[10px] text-accent font-bold uppercase tracking-wider">${data.model}</span>
                         <span class="text-[10px] text-zinc-500 font-mono">${data.width}x${data.height}</span>
                    </div>
                    <p class="text-xs text-zinc-300 line-clamp-2">${data.prompt}</p>
                </div>
            `;
            container.appendChild(div);
        }

        function loadFromHistory(data) {
            state.currentResultUrl = data.image;
            const imgEl = document.getElementById('resultImage');
            imgEl.src = data.image;
            imgEl.classList.remove('hidden');
            document.getElementById('placeholderState').classList.add('hidden');
            document.getElementById('resultActions').classList.remove('hidden');
            document.getElementById('hdLink').href = data.image;
            
            if(window.innerWidth < 768) {
                document.getElementById('viewport').scrollIntoView({ behavior: 'smooth', block: 'start' });
            }
        }

        function clearHistory() {
            if(confirm("Are you sure you want to delete all history?")) {
                const tx = db.transaction(STORE_NAME, "readwrite");
                tx.objectStore(STORE_NAME).clear();
                tx.oncomplete = () => { loadHistory(); updateStorageInfo(); };
            }
        }

        async function updateStorageInfo() {
            if (navigator.storage && navigator.storage.estimate) {
                const estimate = await navigator.storage.estimate();
                const usedMB = (estimate.usage / (1024 * 1024)).toFixed(1);
                document.getElementById('storage-status').innerHTML = `<i class="fa-solid fa-database mr-2"></i>${usedMB} MB Used`;
            }
        }

        window.onload = initDB;
    </script>
</body>
</html>
