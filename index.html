<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Veltrix AI Image Lab</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body {
  margin: 0;
  font-family: Inter, system-ui, sans-serif;
  background: #0b0f1a;
  color: white;
}
header {
  padding: 16px;
  background: #12182b;
  font-size: 22px;
  font-weight: bold;
}
.container {
  max-width: 900px;
  margin: auto;
  padding: 16px;
}
.controls {
  display: flex;
  gap: 8px;
  flex-wrap: wrap;
}
input, select, button {
  padding: 10px;
  border-radius: 8px;
  border: none;
  font-size: 14px;
}
input, select {
  flex: 1;
}
button {
  background: #4f7cff;
  color: white;
  cursor: pointer;
}
button:hover { opacity: .85 }

#result img {
  max-width: 100%;
  border-radius: 12px;
  margin-top: 16px;
}

.grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
  gap: 10px;
  margin-top: 20px;
}
.grid img {
  width: 100%;
  border-radius: 10px;
  cursor: pointer;
  transition: transform .2s;
}
.grid img:hover {
  transform: scale(1.05);
}
footer {
  opacity: .6;
  font-size: 12px;
  text-align: center;
  margin-top: 20px;
}
</style>
</head>

<body>
<header>Veltrix AI Image Lab</header>

<div class="container">
  <div class="controls">
    <input id="prompt" placeholder="Describe your image..." />
    <select id="model">
      <option value="flux-dev">FLUX Dev</option>
      <option value="flux-klein">FLUX Klein</option>
    </select>
    <button onclick="generate()">Generate</button>
  </div>

  <div id="result"></div>

  <h3>Your Gallery</h3>
  <div class="grid" id="history"></div>

  <footer>No login • Local cache • Powered by Veltrix AI</footer>
</div>

<script>
const API_BASE = "https://wild-art-dca7.veltrix620.workers.dev/";

function loadHistory() {
  const data = JSON.parse(localStorage.getItem("aiHistory") || "[]");
  const grid = document.getElementById("history");
  grid.innerHTML = "";
  data.reverse().forEach(item => {
    const img = document.createElement("img");
    img.src = item.image;
    img.title = item.prompt;
    img.onclick = () => showImage(item.image, item.prompt);
    grid.appendChild(img);
  });
}

function saveToHistory(item) {
  let data = JSON.parse(localStorage.getItem("aiHistory") || "[]");
  data.push(item);
  if (data.length > 50) data.shift(); // limit
  localStorage.setItem("aiHistory", JSON.stringify(data));
  loadHistory();
}

function showImage(src, prompt) {
  document.getElementById("result").innerHTML = `
    <p><b>${prompt}</b></p>
    <img src="${src}">
  `;
}

async function generate() {
  const prompt = document.getElementById("prompt").value.trim();
  if (!prompt) return alert("Enter a prompt");
  const model = document.getElementById("model").value;

  document.getElementById("result").innerHTML = "Generating...";

  const url = `${API_BASE}${model}?prompt=${encodeURIComponent(prompt)}&width=1024&height=768`;

  try {
    const res = await fetch(url);
    const data = await res.json();

    if (!data.image) throw "No image";

    const img = `data:image/png;base64,${data.image}`;

    showImage(img, prompt);
    saveToHistory({ image: img, prompt, model, time: Date.now() });

  } catch (e) {
    document.getElementById("result").innerHTML = "Error generating image.";
  }
}

loadHistory();
</script>
</body>
</html>
